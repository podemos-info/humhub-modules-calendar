humhub.module("calendar",function(n,t,i){var r=t("ui.widget").Widget,a=t("client"),o=t("util").object,c=t("ui.modal"),d=t("action"),l=t("content").Content,s=r.extend(),p=r.extend();p.RECUR_EDIT_MODE_CREATE=0,p.RECUR_EDIT_MODE_THIS=1,p.RECUR_EDIT_MODE_FOLLOWING=2,p.RECUR_EDIT_MODE_ALL=3,p.prototype.init=function(){c.global.$.find(".tab-basic").on("shown.bs.tab",function(t){i("#calendarentry-title").focus()}),c.global.$.find(".tab-participation").on("shown.bs.tab",function(t){i("#calendarentry-participation_mode").focus()}),this.initTimeInput()},p.prototype.setEditMode=function(t){var e=t.$trigger.data("editMode");e==p.RECUR_EDIT_MODE_THIS?(i(".tab-recurrence").hide(),i(".field-calendarentryform-is_public").hide()):(i(".tab-recurrence").show(),i(".field-calendarentryform-is_public").show()),this.$.find(".calendar-edit-mode-back").show(),this.$.find(".recurrence-edit-type").hide(),this.$.find(".calendar-entry-form-tabs").show(),this.$.find("#recurrenceEditMode").val(e)},p.prototype.showEditModes=function(t){this.$.find(".calendar-edit-mode-back").hide(),this.$.find(".recurrence-edit-type").show(),this.$.find(".calendar-entry-form-tabs").hide()},p.prototype.initTimeInput=function(t){c.global.$.find(".timeField").find(".form-control").each(function(){var t=i(this);t.prop("disabled")&&t.data("oldVal",t.val()).val("")})},p.prototype.toggleDateTime=function(t){var e=c.global.$.find(".timeField"),o=e.find(".form-control"),n=c.global.$.find(".timeZoneField");t.$trigger.prop("checked")?(o.prop("disabled",!0),o.each(function(){i(this).data("oldVal",i(this).val()).val("")}),e.css("opacity","0.2"),n.hide()):(o.each(function(){var t=i(this);t.data("oldVal")&&t.val(t.data("oldVal"))}),o.prop("disabled",!1),e.css("opacity","1.0"),n.show())},p.prototype.changeTimezone=function(t){var e=this.$.find(".timeZoneInput");this.$.find(".calendar-timezone").text(e.find("option:selected").text()),e.hide()},p.prototype.toggleTimezoneInput=function(t){this.$.find(".timeZoneInput").fadeToggle()},p.prototype.changeParticipationMode=function(t){0==t.$trigger.val()?this.$.find(".participationOnly").fadeOut("fast"):this.$.find(".participationOnly").fadeIn("fast")},p.prototype.changeEventType=function(t){var e=t.$trigger.find(":selected");e.data("type-color")&&(i(".colorpicker-element").data("colorpicker").color.setColor(e.data("type-color")),i(".colorpicker-element").data("colorpicker").update())};function f(t){l.call(this,t)}o.inherits(f,l),f.prototype.toggleClose=function(t){this.update(a.post(t))},f.prototype.reload=function(t){return this.parent().reload()},f.prototype.update=function(t){this.loader(),t.then(i.proxy(this.handleUpdateSuccess,this)).catch(f.handleUpdateError).finally(i.proxy(this.loader,this,!1))},f.prototype.loader=function(t){this.streamEntry().loader(t)},f.prototype.handleUpdateSuccess=function(t){return this.streamEntry().replace(t.output).catch(function(t){n.log.error(t,!0)})},f.handleUpdateError=function(t){n.log.error(t,!0)},f.prototype.streamEntry=function(){return this.parent()};var h=function(){return r.instance("#calendar")};n.export({Calendar:s,respond:function(o){o.block=d.BLOCK_MANUAL,a.post(o).then(function(t){t.success?r.closest(o.$trigger).reload().then(function(){n.log.success("saved")}):(n.log.error(e,!0),o.finish())}).catch(function(t){n.log.error(t,!0),o.finish()})},editModal:function(t){r.closest(t.$trigger).loader(),c.load(t).then(function(t){c.global.$.one("submitted",function(){h().fetch()})}).catch(function(t){n.log.error(t,!0)})},deleteEvent:function(e){r.closest(e.$trigger).loader(),c.confirm().then(function(t){t?a.post(e).then(function(){c.global.close()}).catch(function(t){n.log.error(t,!0)}):r.closest(e.$trigger).loader(!1)}).finally(function(){e.finish()})},CalendarEntry:f,Form:p})});